# Disable new Kafka-based ingest storage (use classic architecture)
mimir:
  structuredConfig:
    multitenancy_enabled: false
    ingest_storage:
      enabled: false
    ingester:
      push_grpc_method_enabled: true
      ring:
        replication_factor: 1
    common:
      storage:
        backend: s3
        s3:
          endpoint: minio.minio.svc.cluster.local:9000
          bucket_name: mimir
          access_key_id: minioadmin
          secret_access_key: minioadmin
          insecure: true
    blocks_storage:
      backend: s3
      s3:
        bucket_name: mimir
      storage_prefix: blocks
    ruler:
      rule_path: /data/ruler-tmp
    ruler_storage:
      backend: s3
      s3:
        bucket_name: mimir
      storage_prefix: ruler
    alertmanager_storage:
      backend: s3
      s3:
        bucket_name: mimir
      storage_prefix: alertmanager
    limits:
      ruler_max_rules_per_rule_group: 30
      # ~200k series from 3 clusters, mostly kube-apiserver histogram buckets (~100k)
      max_global_series_per_user: 300000
      ingestion_rate: 20000
      ingestion_burst_size: 200000

# Disable bundled Kafka
kafka:
  enabled: false

# Disable zone-aware replication
ingester:
  zoneAwareReplication:
    enabled: false
  replicas: 1
  resources:
    requests:
      cpu: 40m
      memory: 768Mi
    limits:
      memory: 768Mi
  persistentVolume:
    enabled: true
    size: 10Gi
    storageClass: standard

distributor:
  replicas: 1
  resources:
    requests:
      cpu: 30m
      memory: 128Mi
    limits:
      memory: 128Mi

querier:
  replicas: 1
  resources:
    requests:
      cpu: 20m
      memory: 256Mi
    limits:
      memory: 256Mi

query_frontend:
  replicas: 1
  resources:
    requests:
      cpu: 20m
      memory: 128Mi
    limits:
      memory: 128Mi

compactor:
  replicas: 1
  resources:
    requests:
      cpu: 10m
      memory: 128Mi
    limits:
      memory: 128Mi

store_gateway:
  zoneAwareReplication:
    enabled: false
  replicas: 1
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      memory: 64Mi

ruler:
  enabled: true
  resources:
    requests:
      cpu: 20m
      memory: 128Mi
    limits:
      memory: 128Mi

query_scheduler:
  replicas: 2
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      memory: 64Mi

overrides_exporter:
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      memory: 64Mi

alertmanager:
  enabled: true
  replicas: 1
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      memory: 64Mi

minio:
  enabled: false

rollout_operator:
  enabled: false

nginx:
  enabled: true
  replicas: 1
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      memory: 32Mi

metaMonitoring:
  serviceMonitor:
    enabled: true
